#!/usr/bin/env bash
set -euo pipefail

echo "DEBUG: Current directory: $(pwd)"
find . -maxdepth 3 -type f -name '*.tar.gz' -print

BLOB_PATH="$(find . -type f -name '*.tar.gz' | head -n 1 || true)"

if [[ -z "$BLOB_PATH" ]]; then
  echo "ERROR: No golang blob found in package source directory"
  exit 1
fi

echo "DEBUG: Using Golang blob: $BLOB_PATH"

# Extract Go into the BOSH install target
mkdir -p "${BOSH_INSTALL_TARGET}"
tar -C "${BOSH_INSTALL_TARGET}" -xzf "$BLOB_PATH"

# Ensure bin is on PATH for dependent packages
ls -l "${BOSH_INSTALL_TARGET}/go/bin"
